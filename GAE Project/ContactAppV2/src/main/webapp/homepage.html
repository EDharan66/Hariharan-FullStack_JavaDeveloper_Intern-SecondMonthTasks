<!DOCTYPE html>
<html>
<head>
<title>Home page</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
	rel="stylesheet">

<!-- Compiled and minified CSS -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
	media="screen,projection" />

<!--Let browser know website is optimized for mobile-->
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
	.cp{
		cursor: pointer;
	}
	form .row{
	     margin-bottom: 0px !important;
	}
	
	form .row .col.s12 {
    	margin: 5px 0px !important;
	}
</style>
<body style="margin: 0"  >


 <nav class="nav-extended">
    <div class="nav-wrapper blue">
      <a href="#" class="brand-logo" style="padding-left: 15px;">Welcome to Contact App</a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
          <li><a id="nameWel">name</a></li>
     <li><a onclick="signOutCall()">sign out</a></li>
      </ul>
    </div>
    <div class="nav-content blue">
      <ul class="tabs tabs-transparent" id="tabs-swipe-demo">
        <li class="tab"><a class="active"  href="#test1">Contacts</a></li>
        <li class="tab"><a href="#test2">profile</a></li>
       
      </ul>
    </div>
  </nav>



  <div id="test1" class="col s12">

<div class="row">
<div class="col s8 offset-s2">
	<div class="row">
		<div class="col s12">
			<h4>Contacts <a class="btn-floating btn waves-effect waves-light blue" onclick="addFun()"><i class="material-icons">add</i></a></h4>
		</div>
		<div class="col s5">
			<select name="searchlist" id="search">
							<option value="name">Name</option>
							<option value="phoneNo">Phone No</option>
							<option value="emailId">Mail Id</option>
							<option value="empId">Employee ID</option>
					</select>
		</div>
		<div class="col s7">
			<input type="text" id="inputSearch" name="value" placeholder="*if choose all enter any value" onkeyup="localSearch()">
		</div>
		<div class="col s2" style="display:none">
			<input type="button" class="btn" value="search" onclick="search()">
		</div>
		
		<div class="col s12" id="empTabList">
		
		    <table>
        <thead>
          <tr>
              <th>Employee Id</th>
              <th>Name</th>
              <th>Email Id</th>
              <th>Phone No</th>
          </tr>
        </thead>

        <tbody id="resultRen">
         
         
        </tbody>
      </table>
		</div>
		<form class="col s4 center" id="editPanal" onsubmit="return callSumbit()" style="display:none">

				<div class="row">
										<div class=" col s12">
											 <h5> <span id="statusText">Update</span> contact <span id="contactNameH4"></span></h5>
										</div>
									</div>
									<div class="row">
										<div class="input-field col s12">
											<input id="signUpname" type="text" class="validate" name="name">
											<label for="signUpname">Name</label>
										</div>
									</div>
									<div class="row">
										<div class="input-field col s12">
											<input id="signUpemailId" type="text" class="validate"
												name="signUpemailId"> <label for="signUpemailId">Email
												Id</label>
										</div>
									</div>
									<div class="row" id="empIdDiv">
										<div class="input-field col s12">
											<input id="signUpempId" type="text" class="validate"
												name="signUpempId"> <label for="signUpempId">Employee
												Id</label>
										</div>
									</div>
									<div class="row">
										<div class="input-field col s12">
											<input id="signUpphoneNo" type="text" class="validate"
												name="signUpphoneNo"> <label for="signUpphoneNo">Phone
												No</label>
										</div>
									</div>

									
<button type="submit" class="waves-effect waves-light btn btn-small right center blue"><span id="statusTextBtn">update</span></button>

									
								</form>
	</div>
</div>
</div>

</div>


  <div id="test2" class="col s12">

<div class="row" style="margin-top: 4em;">
	<div class="col s6 offset-s3">
	 <div class="row">
    <div class="col s12">
      <div class="card blue-grey darken-1">
        <div class="card-content white-text">
        <div id="profileViewPanal">
          <span class="card-title">welcome <span id = "profileNameS1">name</span>! profile <i class="material-icons right cp" onclick="profileEdit()">edit</i> <i class="material-icons right cp" onclick="profileDelete()">delete</i></span>
          <p>Name: <span id = "profileName">name</span></p>
          <p>Email Id: <span id = "profileEmail">email</span></p>
          <p>Employee Id: <span id = "profileEmpId">employee id</span></p>
          <p>Phone No: <span id = "profilePhoneNo">phone No</span></p>
         </div>
         
         <form class="col s4 center" id="profileEditPanal" onsubmit="return profileEditCall()" style="display:none">

				<div class="row">
										<div class=" col s12">
											 <h5> <span id="statusText">Update</span> contact <span id="contactNameH4"></span></h5>
										</div>
									</div>
									<div class="row">
										<div class="input-field col s12">
											<input id="profileNameInput" type="text" class="validate" name="name">
											<label for="profileNameInput">Name</label>
										</div>
									</div>
									<div class="row">
										<div class="input-field col s12">
											<input id="profileEmailInput" type="text" class="validate"
												name="profileEmail"> <label for="profileEmailInput">Email
												Id</label>
										</div>
									</div>
									<div class="row">
										<div class="input-field col s12">
											<input id="profilePhoneNoInput" type="text" class="validate"
												name="profilePhoneNo"> <label for="profilePhoneNoInput">Phone
												No</label>
										</div>
									</div>
									<div class="row">
										<div class="input-field col s12">
											<input id="profilePasswordInput" type="password" class="validate"
												name="profilePhoneNo"> <label for="profilePasswordInput">Password
												</label>
										</div>
									</div>

									
<button type="submit" class="waves-effect waves-light btn btn-small right center blue"><span id="statusTextBtn">update</span></button>

									
								</form>
	
        </div>
       
      </div>
    </div>
  </div>
	</div>
</div>

</div>
 
<!-- Modal Structure -->
  <div id="modal1" class="modal">
    <div class="modal-content">
      <h4>Delete contact <span id="contactNameH4Delete"></span></h4>
      <p>Do you want to delete the contact?</p>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close waves-effect waves-green btn-flat" onclick="deleteFunCall()">Yes</a>
    </div>
  </div>

<script
		src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	<script type="text/javascript">
		M.Tabs.init(document.getElementById("tabs-swipe-demo"));
		document.addEventListener('DOMContentLoaded', function() {
		    var elems = document.querySelectorAll('select');
		    var instances = M.FormSelect.init(elems);
		  });
		
		
	    var instancesModel = M.Modal.init(document.querySelectorAll('.modal'));
		 
		   
	 	var resLocal;
	 	var utils={
				getHTMLFromUrl:(url,method)=>{
					return new Promise(function(resolve, reject) {
						  let req = new XMLHttpRequest();
						  req.open(method, url);
						  req.onload = () => {
						    if (req.status == 200) {
						    	resolve(req.response);
						    } else {
						    	reject("File not Found");
						    }
						  };
						  req.send();
						});
				},
				data:{},
				getDataFromUrl:(url,method,isCatch)=>{
					return new Promise((resolve, reject)=>{ 
						
						const obj = utils.data[url] && isCatch ? utils.data[url] : undefined;
						
						if(!obj){
						
						const xmlhttp = new XMLHttpRequest();
						xmlhttp.open(method,url);
						xmlhttp.onload = (res)=> {
							let currentRes = res.currentTarget;
							if(currentRes.status === 200 && currentRes.responseText ){
								const obj = JSON.parse(currentRes.responseText);
								utils.data[url] = obj;
								resolve(obj)
							}
						}
						xmlhttp.send();
						}else{
							resolve(obj);
						}
						
					});
				},
				callPostWithBodyjson:(url,method,objBody)=>{
					return new Promise(function(resolve, reject) { 
						var xmlhttp = new XMLHttpRequest();
						xmlhttp.open(method, url);
						xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
						xmlhttp.onload = (res) =>{
							if(res.currentTarget.status>=200 && res.currentTarget.status<=299){
								resolve(JSON.parse(res.currentTarget.responseText))
							}else{
								reject(JSON.parse(res.currentTarget.responseText))
							}
						}
						xmlhttp.send(JSON.stringify(objBody));
					});
				}

		}
	 	
	 	var search = ()=>{
	 		const inputSearch = document.getElementById("inputSearch").value;
	 		const inputSearchDrop = document.getElementById("search").value;
	 		console.log({inputSearch,inputSearchDrop})
	 		
	 		utils.getDataFromUrl("/search?type="+inputSearchDrop+"&value="+inputSearch,"GET",false).then((res)=>{
	 			console.log({res})
	 			resLocal = res;
	 			 document.getElementById("resultRen").innerHTML = res.map(it=> {
	 				 return "<tr><td>"+it.empId+"</td><td>"+it.name+"</td><td>"+it.emailId+"</td><td>"+it.phoneNo+"</td><td> <i class='tiny material-icons cp' onclick='editFun("+it.empId+")'>edit</i></td><td> <i class='tiny material-icons cp' onclick='deleteFun("+it.empId+")'>delete</i></td></tr>"
	 			 }).toString().replace(/,/g,'');
	 		})
	 		
	 		document.getElementById("empTabList").className="col s12";
	 		document.getElementById("editPanal").style.display="none";
	 	}
	 	
	 	var localSearch = ()=>{
	 		if(resLocal && resLocal.length !== 0){
	 		const inputSearch = document.getElementById("inputSearch").value;
	 		const inputSearchDrop = document.getElementById("search").value;
	 		console.log({inputSearch,inputSearchDrop})
	 		
	 		 document.getElementById("resultRen").innerHTML = resLocal.filter(it=>{
	 			 return it[inputSearchDrop].includes(inputSearch)
	 		 }).map(it=> {
	 			return "<tr><td>"+it.empId+"</td><td>"+it.name+"</td><td>"+it.emailId+"</td><td>"+it.phoneNo+"</td><td> <i class='tiny material-icons cp' onclick='editFun("+it.empId+")'>edit</i></td><td> <i class='tiny material-icons cp' onclick='deleteFun("+it.empId+")'>delete</i></td></tr>"
 			 }).toString().replace(/,/g,'');
	 		
	 		document.getElementById("empTabList").className="col s12";
	 		document.getElementById("editPanal").style.display="none";
	 		}
	 	}
	 	
	 	search();
	 	var editFun = (id)=>{
	 		document.getElementById("empTabList").className="col s8";
	 		document.getElementById("editPanal").style.display="block";
	 		document.getElementById("empIdDiv").style.display="none";
	 		const empObj = resLocal.filter(it=>{return it.empId === id})[0];
	 		document.getElementById("contactNameH4").innerText = empObj.name;
	 		document.getElementById("statusText").innerText = "Update";
	 		document.getElementById("statusTextBtn").innerText = "Update";
	 		
	 		document.getElementById("signUpname").value = empObj.name;
	 		document.querySelectorAll('[for="signUpname"]')[0].className="active"
	 		
	 		document.getElementById("signUpemailId").value = empObj.emailId;
	 		document.querySelectorAll('[for="signUpemailId"]')[0].className="active"
	 		
	 		document.getElementById("signUpempId").value = empObj.empId;
	 		document.querySelectorAll('[for="signUpempId"]')[0].className="active"
	 		
	 		document.getElementById("signUpphoneNo").value = empObj.phoneNo;
	 		document.querySelectorAll('[for="signUpphoneNo"]')[0].className="active"
	 	}
	 	var deleteId;
	 	var deleteFun = (id)=>{
	 		console.log({id})
	 		const empObj = resLocal.filter(it=>{return it.empId === id})[0];
	 		document.getElementById("contactNameH4Delete").innerText = empObj.name;
	 		deleteId = id;
	 		instancesModel[0].open();
	 	}
	 	
	 	var deleteFunCall = (id)=>{
	 		
	 		utils.callPostWithBodyjson('contact?empId='+deleteId,"DELETE",{}).then((res)=>{
				 M.toast({html: 'Sucessfuly delete contact details'})
		 		search();
				 instancesModel[0].close();
			},(err)=>{
				 M.toast({html: 'Sucessfuly failed to delete contact details'})
			})
	 	}
	 	
	 	var addFun = () =>{
	 		document.getElementById("empTabList").className="col s8";
	 		document.getElementById("editPanal").style.display="block";
	 		document.getElementById("empIdDiv").style.display="block";
	 		document.getElementById("statusText").innerText = "Add";
	 		document.getElementById("statusTextBtn").innerText = "Add Contact";
	 		document.getElementById("contactNameH4").innerText = "";
	 		document.getElementById("signUpname").value = "";
	 		document.querySelectorAll('[for="signUpname"]')[0].className=""
	 		
	 		document.getElementById("signUpemailId").value = "";
	 		document.querySelectorAll('[for="signUpemailId"]')[0].className=""
	 		
	 		document.getElementById("signUpempId").value = "";
	 		document.querySelectorAll('[for="signUpempId"]')[0].className=""
	 		
	 		document.getElementById("signUpphoneNo").value ="";
	 		document.querySelectorAll('[for="signUpphoneNo"]')[0].className=""
	 	}
	 	
	 	var callSumbit = ()=>{
	 		
	 		const isAddCall = document.getElementById("statusText").innerText === "Add"
	 		
	 			var jsonBody = {
				name:document.getElementById("signUpname").value,
				emailId:document.getElementById("signUpemailId").value,			
				empId:document.getElementById("signUpempId").value,					
				phoneNo:document.getElementById("signUpphoneNo").value								
		};
	 		
	 		if(isAddCall){
	 			utils.callPostWithBodyjson('contact',"POST",jsonBody).then((res)=>{
	 				 M.toast({html: 'Sucessfuly add contact'})
	 				document.getElementById("empTabList").className="col s12";
	 		 		document.getElementById("editPanal").style.display="none";
	 		 		search();
	 			},(err)=>{
	 				 M.toast({html: 'Sucessfuly failed contact'})
	 			})
	 		}else{
	 			utils.callPostWithBodyjson('contact',"PUT",jsonBody).then((res)=>{
	 				 M.toast({html: 'Sucessfuly update contact details'})
	 				document.getElementById("empTabList").className="col s12";
	 		 		document.getElementById("editPanal").style.display="none";
	 		 		search();
	 			},(err)=>{
	 				 M.toast({html: 'Sucessfuly failed to update contact details'})
	 			})
	 		}
	 		
	 		return false;
	 	}
	 	
	 	
	 	var profileObj;
	 	var profileLoad = (isNeedCatch)=>{
	 		utils.getDataFromUrl("/profile","GET",isNeedCatch).then((res)=>{
	 			profileObj = res;
	 			document.getElementById("profileViewPanal").style.display="block";
				document.getElementById("profileEditPanal").style.display="none";
	 			document.getElementById("nameWel").innerText = res.name;
	 			document.getElementById("profileNameS1").innerText =  res.name;
	 			document.getElementById("profileName").innerText =  res.name;
	 			document.getElementById("profileEmail").innerText =  res.emailId;
	 			document.getElementById("profileEmpId").innerText =  res.empId;
	 			document.getElementById("profilePhoneNo").innerText =  res.phoneNo;
	 		})
	 	}
	 	
	 	profileLoad(true);
	 	
		var profileEdit = ()=>{
			
			document.getElementById("profileViewPanal").style.display="none";
			document.getElementById("profileEditPanal").style.display="block";
			
			document.getElementById("profileNameInput").value = profileObj.name;
	 		document.querySelectorAll('[for="profileNameInput"]')[0].className="active"
	 		
	 		document.getElementById("profileEmailInput").value = profileObj.emailId;
	 		document.querySelectorAll('[for="profileEmailInput"]')[0].className="active"
	 		
	 		document.getElementById("profilePhoneNoInput").value = profileObj.phoneNo;
	 		document.querySelectorAll('[for="profilePhoneNoInput"]')[0].className="active"
	 		
	 	} 
	 	var profileEditCall = ()=>{
	 		
	 		var jsonBody = {
	 				
	 		    password: document.getElementById("profilePasswordInput").value,
	 			name: document.getElementById("profileNameInput").value,
	 			emailId: document.getElementById("profileEmailInput").value,
	 			phoneNo: document.getElementById("profilePhoneNoInput").value,
	 		}
	 		utils.callPostWithBodyjson('profile',"PUT",jsonBody).then((res)=>{
				 M.toast({html: 'Sucessfuly update contact profile'})
				 profileLoad(false);
	 		})
	 		
	 		return false;
	 	}
	 	
		var profileDelete = ()=>{
	 		
			utils.callPostWithBodyjson('profile',"DELETE",{}).then((res)=>{
				 M.toast({html: 'Sucessfuly delete the contact profile'})
				 location.href="/";
	 		})
	 	}
	 	
		var signOutCall = ()=>{
			utils.callPostWithBodyjson('signout',"POST",{}).then((res)=>{
				 M.toast({html: 'Sucessfuly Logout the contact profile'})
				 location.href="/";
	 		})
		}
		
	 	
		</script>	

</body>
</html>



